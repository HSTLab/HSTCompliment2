<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì¹­ì°¬ í†¡í†¡ â€” ì¹­ì°¬ë³´ë“œ</title>
  <style>
    :root{
      --bg:#f6fbff;--card:#ffffff;--ink:#0f172a;--muted:#64748b;--pri:#3b82f6;--pri-weak:#dbeafe;--rose:#f43f5e;--led:#00ffd1;
    }
    *{box-sizing:border-box}
    html,body{margin:0;height:100%;font-family:ui-rounded,system-ui,-apple-system,Segoe UI,Roboto,Pretendard,Apple SD Gothic Neo,Noto Sans KR,sans-serif;color:var(--ink);}    
    body{background:linear-gradient(180deg,#eaf6ff 0%, #fff 55%, #fff 100%);} 
    .container{max-width:960px;margin:0 auto;padding:20px 16px 64px;}
    .title{display:flex;align-items:center;gap:12px}
    .title h1{margin:0;font-size:1.8rem}
    .sub{color:var(--muted);margin-top:4px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    @media (max-width:860px){.grid{grid-template-columns:1fr}}
    .card{background:var(--card);border:1px solid #e5e7eb;border-radius:16px;box-shadow:0 6px 20px rgba(30,64,175,.08);}    
    .card h2{margin:0 0 10px;font-size:1.2rem}
    .card .content{padding:16px}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .row > *{flex:1}
    label{font-size:.9rem;color:var(--muted)}
    input[type="text"], textarea, select{width:100%;padding:10px 12px;border-radius:12px;border:1px solid #d1d5db;background:#fff;font-size:1rem}
    textarea{resize:vertical;min-height:88px}
    .btn{appearance:none;border:0;border-radius:12px;padding:10px 14px;background:var(--pri);color:#fff;font-weight:700;cursor:pointer;box-shadow:0 4px 12px rgba(59,130,246,.25)}
    .btn.ghost{background:#fff;color:#1e40af;border:1px solid #bfdbfe}
    .btn.small{padding:6px 10px;border-radius:10px;font-weight:600}
    .muted{color:var(--muted);font-size:.9rem}
    .list{display:grid;gap:10px;margin-top:12px}
    .chip{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;background:#eef2ff;color:#3730a3;border:1px solid #c7d2fe;font-weight:600;font-size:.85rem}
    .note{border:1px dashed #cbd5e1;padding:10px;border-radius:12px;background:#f8fafc;color:#0f172a}

    /* ì¹­ì°¬ ì¹´ë“œ */
    .compliment{background:#ffffff;border:1px solid #e5e7eb;border-radius:14px;padding:12px 12px}
    .compliment .meta{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
    .to{font-weight:800}
    .msg{margin:6px 0 10px;white-space:pre-wrap}
    .actions{display:flex;gap:8px}
    .like{display:inline-flex;align-items:center;gap:6px;border-radius:999px;border:1px solid #fecaca;background:#fff5f5;color:#b91c1c;padding:6px 10px;cursor:pointer}
    .stamp{font-size:.8rem;color:#64748b}

    /* ===== ì „ê´‘íŒ(LED) ì˜¤ë²„ë ˆì´ ===== */
    .overlay{position:fixed;inset:0;background:radial-gradient(1000px 600px at 50% -10%, rgba(1,8,20,.95), rgba(0,0,0,.98));display:none;align-items:center;justify-content:center;padding:24px;z-index:50}
    .overlay.show{display:flex}
    .marquee{width:min(1100px,96vw);height:min(82vh,760px);background:#030712;border-radius:24px;border:2px solid rgba(0,255,209,.2);box-shadow:0 20px 80px rgba(0,255,209,.08), inset 0 0 40px rgba(0,255,209,.06);display:flex;flex-direction:column;overflow:hidden}
    .marqueeHeader{display:flex;align-items:center;gap:10px;padding:12px 16px;border-bottom:1px solid #0f172a;background:#020617;color:#e2e8f0}
    .marqueeHeader h3{margin:0;font-size:1.1rem}
    .marqueeBody{flex:1;display:flex;align-items:center;justify-content:center;padding:24px;background:#020617}

    .marqueeCard{position:relative;width:100%;max-width:900px;border:2px solid rgba(0,255,209,.2);border-radius:20px;background:#000;box-shadow:inset 0 0 40px rgba(0,255,209,.05),0 0 80px rgba(0,0,0,.6);padding:28px}
    .marqueeCard::before{content:"";position:absolute;inset:0;border-radius:18px;background-image:radial-gradient(circle at center, rgba(255,255,255,.07) 11%, transparent 12%),radial-gradient(circle at center, rgba(255,255,255,.07) 11%, transparent 12%);background-size:12px 12px,12px 12px;background-position:0 0,6px 6px;opacity:.55;pointer-events:none}
    .marqueeCard::after{content:"";position:absolute;inset:0;border-radius:18px;background:linear-gradient(120deg, transparent 20%, rgba(255,255,255,.05) 40%, transparent 60%);filter:blur(0.5px);animation:scan 6s linear infinite;mix-blend-mode:screen;pointer-events:none}
    @keyframes scan{from{transform:translateX(-120%)}to{transform:translateX(120%)}}

    .led{color:var(--led);text-shadow:0 0 6px var(--led),0 0 12px var(--led),0 0 22px var(--led),0 0 38px color-mix(in oklab, var(--led) 70%, black);letter-spacing:.5px;filter:saturate(1.2)}
    .led.big{font-size:2rem;font-weight:900}
    .led.mid{font-size:1.4rem;font-weight:800}
    .led.meta{font-size:1rem;font-weight:700;opacity:.95}
    .ledAccent{color:#ffb100;text-shadow:0 0 6px #ffb100,0 0 14px #ffb100}
    .flicker{animation:flicker 2.8s infinite steps(1,end)}
    @keyframes flicker{0%{opacity:.95}3%{opacity:.8}6%{opacity:1}7%{opacity:.88}10%{opacity:1}13%{opacity:.9}16%{opacity:1}22%{opacity:.85}100%{opacity:1}}

    .marqueeFooter{display:flex;align-items:center;gap:8px;justify-content:space-between;padding:12px 16px;border-top:1px solid #0f172a;background:#020617;color:#e2e8f0}
    .toolbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .toolbar select{padding:6px 10px;border-radius:10px;border:1px solid #334155;background:#0b1220;color:#e2e8f0}
  </style>
</head>
<body>
  <div class="container">
    <div class="title">
      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 3l2.39 4.84L20 9.27l-4 3.9.94 5.48L12 16.9l-4.94 1.75L8 13.17l-4-3.9 5.61-1.43L12 3z" stroke="#1e40af" stroke-width="1.2" fill="#bfdbfe"/></svg>
      <div>
        <h1>ì¹­ì°¬ í†¡í†¡</h1>
        <div class="sub">ìš°ë¦¬ ë°˜ì„ ì¹­ì°¬ìœ¼ë¡œ ë¬¼ë“¤ì´ëŠ” ê³µê°„ âœ¨</div>
      </div>
    </div>

    <!-- ì¹­ì°¬ë³´ë“œ -->
    <section id="compliments" class="tabPanel">
      <div class="grid">
        <div class="card">
          <div class="content">
            <h2>ì¹­ì°¬ ë‚¨ê¸°ê¸°</h2>
            <div class="row">
              <div>
                <label for="to">ëˆ„êµ¬ì—ê²Œ</label>
                <input id="to" type="text" placeholder="ì˜ˆ: 4ë²ˆ ë¯¼ìˆ˜ / ì¹œí•œ ì¹œêµ¬ / ì„ ìƒë‹˜" />
              </div>
              <div>
                <label for="from">ëˆ„ê°€(ì„ íƒ)</label>
                <input id="from" type="text" placeholder="ì˜ˆ: í•˜ì€ / ë¹„ì›Œë‘ë©´ ìµëª…" />
              </div>
            </div>
            <div style="margin-top:8px"></div>
            <div>
              <label for="msg">ì¹­ì°¬ ë‚´ìš©</label>
              <textarea id="msg" placeholder="ì˜ˆ: ì˜¤ëŠ˜ ê³¼í•™ ì‹œê°„ì— ì‹¤í—˜ ë„êµ¬ ì •ë¦¬ë¥¼ ë„ì™€ì¤˜ì„œ ê³ ë§ˆì› ì–´!"></textarea>
            </div>
            <div class="row" style="margin-top:10px">
              <div>
                <label for="tag">íƒœê·¸(ì„ íƒ)</label>
                <select id="tag">
                  <option value="">ì„ íƒ ì—†ìŒ</option>
                  <option>ì¹œì ˆ</option>
                  <option>í˜‘ë™</option>
                  <option>ì±…ì„ê°</option>
                  <option>ë„ì›€</option>
                  <option>ì •ë¦¬ì •ëˆ</option>
                </select>
              </div>
              <div style="flex:0 0 auto;display:flex;align-items:flex-end;gap:8px">
                <button class="btn" onclick="addCompliment()">ê²Œì‹œí•˜ê¸°</button>
                <button class="btn ghost" onclick="seedCompliments()" title="ì˜ˆì‹œ ë°ì´í„° ì¶”ê°€">ì˜ˆì‹œ</button>
              </div>
            </div>
            <div class="note" style="margin-top:12px">âœ… ì„œë¡œë¥¼ ì¡´ì¤‘í•˜ëŠ” ë§ë§Œ ì¨ìš”. ì‹¤ëª… ëŒ€ì‹  ë²ˆí˜¸/ë³„ì¹­ ì‚¬ìš© ê°€ëŠ¥í•´ìš”. ë¶€ì ì ˆí•œ ê¸€ì€ ìˆ¨ê¹€ ì²˜ë¦¬ë  ìˆ˜ ìˆì–´ìš”.</div>
          </div>
        </div>

        <div class="card">
          <div class="content">
            <div style="display:flex;align-items:center;justify-content:space-between;gap:8px">
              <h2 style="margin:0">ìš°ë¦¬ ë°˜ ì¹­ì°¬</h2>
              <div class="toolbar">
                <button class="btn small" onclick="openMarquee()">ì „ê´‘íŒ ëª¨ë“œ</button>
                <button class="btn small ghost" onclick="editPin()" title="êµì‚¬ìš© PIN ì„¤ì •">PIN ì„¤ì •</button>
              </div>
            </div>
            <div class="row" style="margin-bottom:8px;margin-top:8px">
              <div>
                <label for="filter">ê²€ìƒ‰</label>
                <input id="filter" type="text" placeholder="ì´ë¦„/ë²ˆí˜¸/ë‚´ìš© ê²€ìƒ‰" oninput="renderCompliments()" />
              </div>
              <div>
                <label for="sort">ì •ë ¬</label>
                <select id="sort" onchange="renderCompliments()">
                  <option value="latest">ìµœì‹ ìˆœ</option>
                  <option value="likes">ì¸ê¸°ìˆœ(í•˜íŠ¸)</option>
                </select>
              </div>
              <div style="flex:0 0 auto;display:flex;align-items:flex-end">
                <button class="btn small ghost" onclick="clearCompliments()" title="ë¡œì»¬ ì €ì¥ ë‚´ìš© ì´ˆê¸°í™”">ì´ˆê¸°í™”</button>
              </div>
            </div>
            <div id="complimentList" class="list"></div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- ì „ê´‘íŒ(LED) ì˜¤ë²„ë ˆì´ -->
  <div id="overlay" class="overlay" aria-hidden="true">
    <div class="marquee" role="dialog" aria-label="ì „ê´‘íŒ ëª¨ë“œ">
      <div class="marqueeHeader">
        <h3>ì „ê´‘íŒ ëª¨ë“œ â€” ìš°ë¦¬ ë°˜ ì¹­ì°¬</h3>
        <div class="toolbar" style="margin-left:auto">
          <label class="muted">ì†ë„</label>
          <select id="speed" onchange="changeSpeed()">
            <option value="3000">ë¹ ë¥´ê²Œ (3ì´ˆ)</option>
            <option value="5000" selected>ë³´í†µ (5ì´ˆ)</option>
            <option value="8000">ì²œì²œíˆ (8ì´ˆ)</option>
          </select>
          <label class="muted">ì •ë ¬</label>
          <select id="marqueeSort" onchange="reloadMarquee()">
            <option value="latest">ìµœì‹ ìˆœ</option>
            <option value="likes">ì¸ê¸°ìˆœ(í•˜íŠ¸)</option>
          </select>
          <label class="muted">LED ìƒ‰</label>
          <select id="ledColor" onchange="changeLedColor()">
            <option value="#00ffd1" selected>ë¯¼íŠ¸</option>
            <option value="#eaff00">ë ˆëª¬</option>
            <option value="#ff3df0">í•‘í¬</option>
            <option value="#ffb100">ì£¼í™©</option>
            <option value="#ff2d2d">ë¹¨ê°•</option>
            <option value="#46a3ff">í•˜ëŠ˜</option>
          </select>
          <button class="btn small ghost" onclick="toggleFullscreen()">ì „ì²´í™”ë©´</button>
          <button class="btn small" onclick="closeMarquee()">ë‹«ê¸° Esc</button>
        </div>
      </div>
      <div id="marqueeBody" class="marqueeBody"></div>
      <div class="marqueeFooter">
        <div class="toolbar">
          <button class="btn small ghost" onclick="prevSlide()">â—€ ì´ì „</button>
          <button id="playBtn" class="btn small" onclick="togglePlay()">â¸ ì¼ì‹œì •ì§€</button>
          <button class="btn small ghost" onclick="nextSlide()">ë‹¤ìŒ â–¶</button>
        </div>
        <div class="muted" id="counter">0 / 0</div>
      </div>
    </div>
  </div>

  <script>
    // ===== Storage helpers =====
    const LS_KEY_C = 'compliments_v1';
    const LS_KEY_PIN = 'teacher_pin_v1';
    function readCompliments(){ try{ return JSON.parse(localStorage.getItem(LS_KEY_C)||'[]'); }catch{return []} }
    function writeCompliments(arr){ localStorage.setItem(LS_KEY_C, JSON.stringify(arr)); }
    function getPin(){ return localStorage.getItem(LS_KEY_PIN) || '1234'; }
    function setPin(newPin){ localStorage.setItem(LS_KEY_PIN, newPin); }
    function requirePin(){ const input = window.prompt('ê´€ë¦¬ì PINì„ ì…ë ¥í•˜ì„¸ìš” (ê¸°ë³¸ 1234)'); return input!==null && input.trim()===getPin(); }

    // ===== CRUD & UI =====
    function addCompliment(){
      const to = document.getElementById('to').value.trim();
      const from = document.getElementById('from').value.trim();
      const msg = document.getElementById('msg').value.trim();
      const tag = document.getElementById('tag').value;
      if(!to || !msg){ alert('"ëˆ„êµ¬ì—ê²Œ"ì™€ "ì¹­ì°¬ ë‚´ìš©"ì„ ì±„ì›Œì£¼ì„¸ìš”!'); return; }
      const arr = readCompliments();
      arr.unshift({id:crypto.randomUUID(), to, from: from||'ìµëª…', msg, tag, likes:0, ts:Date.now(), hidden:false});
      writeCompliments(arr); document.getElementById('msg').value=''; renderCompliments();
    }

    function likeCompliment(id){ const arr = readCompliments(); const it = arr.find(x=>x.id===id); if(!it) return; it.likes = (it.likes||0) + 1; writeCompliments(arr); renderCompliments(); }
    function hideCompliment(id){
      if(!requirePin()) { alert('PINì´ ì˜¬ë°”ë¥´ì§€ ì•Šì•„ìš”. (ê¸°ë³¸ 1234)'); return; }
      const arr = readCompliments();
      const it = arr.find(x=>x.id===id); if(!it) return; it.hidden = true; writeCompliments(arr); renderCompliments();
    }
    function clearCompliments(){ if(confirm('ë¡œì»¬ì— ì €ì¥ëœ ì¹­ì°¬ ê¸€ì„ ëª¨ë‘ ì§€ìš¸ê¹Œìš”?')){ localStorage.removeItem(LS_KEY_C); renderCompliments(); }}

    function fmtTime(ts){ const d=new Date(ts); return `${d.getMonth()+1}/${d.getDate()} ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}` }
    function escapeHtml(str){ return (str+"").replace(/[&<>"']/g,s=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[s])); }

    // êµì‚¬ìš© PIN ì„¤ì •
    function editPin(){
      const current = window.prompt('í˜„ì¬ PINì„ ì…ë ¥í•˜ì„¸ìš” (ê¸°ë³¸ 1234)');
      if(current===null) return;
      if((current||'').trim()!==getPin()) { alert('í˜„ì¬ PINì´ ì˜¬ë°”ë¥´ì§€ ì•Šì•„ìš”.'); return; }
      const np = window.prompt('ìƒˆ PINì„ ì…ë ¥í•˜ì„¸ìš” (4~8ìë¦¬ ê¶Œì¥)');
      if(np===null || !np.trim()) return alert('ë³€ê²½ì´ ì·¨ì†Œë˜ì—ˆì–´ìš”.');
      const np2 = window.prompt('ìƒˆ PINì„ í•œ ë²ˆ ë” ì…ë ¥í•˜ì„¸ìš”');
      if(np2===null) return;
      if(np.trim()!==np2.trim()) return alert('ë‘ PINì´ ì¼ì¹˜í•˜ì§€ ì•Šì•„ìš”.');
      setPin(np.trim()); alert('PINì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }

    function getFilteredSortedItems(sortOverride){
      const q = (document.getElementById('filter')?.value||'').toLowerCase();
      const sort = sortOverride || (document.getElementById('sort')?.value||'latest');
      let items = readCompliments().filter(x=>!x.hidden);
      if(q){ items = items.filter(x => [x.to,x.from,x.msg,(x.tag||'')].join(' ').toLowerCase().includes(q)); }
      if(sort==='likes'){ items.sort((a,b)=> (b.likes||0)-(a.likes||0) || b.ts-a.ts); } else { items.sort((a,b)=>b.ts-a.ts); }
      return items;
    }

    function renderCompliments(){
      const wrap = document.getElementById('complimentList');
      const items = getFilteredSortedItems();
      wrap.innerHTML = items.length ? '' : '<div class="muted">ì•„ì§ ì¹­ì°¬ì´ ì—†ì–´ìš”. ì²« ì¹­ì°¬ì˜ ì£¼ì¸ê³µì´ ë˜ì–´ ì£¼ì„¸ìš”! ğŸŒŸ</div>';
      for(const it of items){
        const card = document.createElement('div');
        card.className='compliment';
        card.innerHTML = `
          <div class="meta">
            <div><span class="chip">To</span> <span class="to">${escapeHtml(it.to)}</span> ${it.tag?`<span class="chip">#${escapeHtml(it.tag)}</span>`:''}</div>
            <div class="stamp">${fmtTime(it.ts)}</div>
          </div>
          <div class="msg">${escapeHtml(it.msg)}</div>
          <div class="row" style="align-items:center;">
            <div class="muted">From <b>${escapeHtml(it.from)}</b></div>
            <div class="actions" style="margin-left:auto">
              <button class="like" onclick="likeCompliment('${it.id}')" title="ì‘ì›í•˜ê¸°">
                <span>â¤ï¸</span><span>${it.likes||0}</span>
              </button>
              <button class="btn small ghost" onclick="hideCompliment('${it.id}')" title="ë¶€ì ì ˆ ì‹ ê³ /ìˆ¨ê¹€">ìˆ¨ê¹€</button>
            </div>
          </div>`;
        card.querySelector('.like').type = 'button';
        wrap.appendChild(card);
      }
    }

    // ===== seedCompliments (ì˜ˆì‹œ ë°ì´í„° ì¶”ê°€) =====
    function seedCompliments(){
      if(!confirm('ì˜ˆì‹œ ì¹­ì°¬ 4ê°œë¥¼ ì¶”ê°€í• ê¹Œìš”?')) return;
      const arr = readCompliments();
      const seeds = [
        {to:'5ë²ˆ ì†Œìœ¤', from:'ìµëª…', msg:'ì²´ìœ¡ ì‹œê°„ì— ë„˜ì–´ì¡Œì„ ë•Œ ë¨¼ì € ë‹¤ê°€ì™€ ê´œì°®ëƒê³  ë¬¼ì–´ë´ ì¤˜ì„œ ê³ ë§ˆì› ì–´!', tag:'ì¹œì ˆ'},
        {to:'4ë²ˆ ë¯¼ìˆ˜', from:'í•˜ì¤€', msg:'ë¯¸ìˆ  ì‹œê°„ ì¤€ë¹„ë¬¼ì„ ìŠì€ ë‚˜ì—ê²Œ ìƒ‰ì—°í•„ì„ ë¹Œë ¤ì¤˜ì„œ ê³ ë§ˆì›Œ!', tag:'ë„ì›€'},
        {to:'ëª¨ë‘  3', from:'ì˜ˆë‚˜', msg:'ê³¼í•™ ì‹¤í—˜ í›„ ì •ë¦¬ì •ëˆì„ í•¨ê»˜ í•´ì¤˜ì„œ ìµœê³ ì˜€ì–´!', tag:'ì •ë¦¬ì •ëˆ'},
        {to:'ì „ì²´ ì¹œêµ¬ë“¤', from:'ë‹´ì„', msg:'ì•„ì¹¨ ì¸ì‚¬ë„ ë˜ë ·í•˜ê²Œ í•˜ê³  ì„œë¡œ ì˜ˆì˜ ë°”ë¥´ê²Œ ëŒ€í•´ ì¤˜ì„œ ì •ë§ ìë‘ìŠ¤ëŸ¬ì›Œìš”!', tag:'ì±…ì„ê°'}
      ];
      seeds.reverse().forEach(s=>arr.unshift({id:crypto.randomUUID(), likes:Math.floor(Math.random()*4), ts:Date.now()-Math.floor(Math.random()*1e6), hidden:false, ...s}));
      writeCompliments(arr); renderCompliments();
    }

    // ===== ì „ê´‘íŒ(ìë™ ìŠ¤í¬ë¡¤, LED ìŠ¤íƒ€ì¼) =====
    const overlay = document.getElementById('overlay');
    const marqueeBody = document.getElementById('marqueeBody');
    const counter = document.getElementById('counter');
    const playBtn = document.getElementById('playBtn');
    let slides = []; let idx = 0; let timer = null; let interval = 5000;

    function openMarquee(){
      slides = getFilteredSortedItems(document.getElementById('marqueeSort').value);
      if(!slides.length){ alert('í‘œì‹œí•  ì¹­ì°¬ì´ ì—†ì–´ìš”! ë¨¼ì € ì¹­ì°¬ì„ ì¶”ê°€í•´ ì£¼ì„¸ìš”.'); return; }
      idx = 0; overlay.classList.add('show'); overlay.setAttribute('aria-hidden','false');
      buildSlide(); startAuto(); document.addEventListener('keydown', keyHandler);
    }
    function closeMarquee(){ stopAuto(); overlay.classList.remove('show'); overlay.setAttribute('aria-hidden','true'); document.removeEventListener('keydown', keyHandler); }

    function keyHandler(e){ if(e.key==='Escape') return closeMarquee(); if(e.key==='ArrowRight') return nextSlide(); if(e.key==='ArrowLeft') return prevSlide(); if(e.key===' ') { e.preventDefault(); togglePlay(); } }

    function buildSlide(){
      const it = slides[idx]; if(!it) return;
      marqueeBody.innerHTML = `
        <div class="marqueeCard">
          <div class="led big flicker">To ${escapeHtml(it.to)} ${it.tag?`<span class="chip">#${escapeHtml(it.tag)}</span>`:''}</div>
          <div class="led mid" style="margin-top:8px">${escapeHtml(it.msg)}</div>
          <div class="led meta" style="margin-top:14px;display:flex;gap:14px;align-items:center">
            <div>From <b>${escapeHtml(it.from)}</b></div>
            <div class="ledAccent">â¤ï¸ ${it.likes||0}</div>
            <div>${fmtTime(it.ts)}</div>
          </div>
        </div>`;
      counter.textContent = `${idx+1} / ${slides.length}`;
    }

    function nextSlide(){ idx = (idx+1) % slides.length; buildSlide(); }
    function prevSlide(){ idx = (idx-1+slides.length) % slides.length; buildSlide(); }

    function startAuto(){ stopAuto(); timer = setInterval(nextSlide, interval); if(playBtn) playBtn.textContent = 'â¸ ì¼ì‹œì •ì§€'; }
    function stopAuto(){ if(timer){ clearInterval(timer); timer=null; } if(playBtn) playBtn.textContent = 'â–¶ ì¬ìƒ'; }
    function togglePlay(){ if(timer){ stopAuto(); } else { startAuto(); } }

    function changeSpeed(){ interval = parseInt(document.getElementById('speed').value,10)||5000; if(timer){ startAuto(); } }
    function reloadMarquee(){ slides = getFilteredSortedItems(document.getElementById('marqueeSort').value); idx = 0; buildSlide(); }
    function changeLedColor(){ const c = document.getElementById('ledColor').value; document.documentElement.style.setProperty('--led', c); }

    async function toggleFullscreen(){ const el = document.querySelector('.marquee'); if(!document.fullscreenElement){ try{ await el.requestFullscreen(); }catch{} } else{ await document.exitFullscreen(); } }

    // ===== Tests =====
    function assert(cond, msg){ if(!cond) throw new Error(msg); }
    window.runTests = function(){
      const backup = readCompliments();
      const backupPin = getPin();
      try{
        // Ensure a clean state
        writeCompliments([]);

        // Test 1: addCompliment should add one and render
        document.getElementById('to').value = '1ë²ˆ ë„í˜„';
        document.getElementById('from').value = 'ì§€ìš°';
        document.getElementById('msg').value = 'ë…ì„œì‹œê°„ì— ì±… ë‚˜ëˆ ì¤˜ì„œ ê³ ë§ˆì›Œ!';
        document.getElementById('tag').value = 'ë„ì›€';
        addCompliment();
        assert(readCompliments().length===1,'addComplimentê°€ í•­ëª©ì„ ì¶”ê°€í•˜ì§€ ì•ŠìŒ');
        assert(document.getElementById('complimentList').children.length>=1,'addCompliment í›„ ë Œë” ì‹¤íŒ¨');

        // Test 2: seedCompliments adds more
        const before = readCompliments().length;
        const _confirm = window.confirm; window.confirm = ()=>true; seedCompliments(); window.confirm = _confirm;
        const after = readCompliments().length;
        assert(after>before,'seedComplimentsê°€ í•­ëª©ì„ ì¶”ê°€í•˜ì§€ ì•ŠìŒ');

        // Test 3: hide with wrong/correct PIN
        setPin('9999');
        const firstId = readCompliments()[0].id;
        const _prompt = window.prompt; window.prompt = ()=> '0000'; // wrong PIN
        hideCompliment(firstId);
        window.prompt = _prompt;
        assert(readCompliments().find(x=>x.id===firstId)?.hidden!==true,'ì˜ëª»ëœ PINì¸ë° ìˆ¨ê¹€ ì²˜ë¦¬ë¨');
        window.prompt = ()=> '9999';
        hideCompliment(firstId);
        window.prompt = _prompt;
        assert(readCompliments().find(x=>x.id===firstId)?.hidden===true,'ì˜¬ë°”ë¥¸ PINì¸ë° ìˆ¨ê¹€ ì‹¤íŒ¨');

        // Test 4: open/close marquee flow
        // make sure at least one visible item exists
        const anyVisible = readCompliments().some(x=>!x.hidden);
        if(!anyVisible){
          const arr = readCompliments(); arr.unshift({id:crypto.randomUUID(), to:'í…ŒìŠ¤íŠ¸', from:'ì‹œìŠ¤í…œ', msg:'ê°€ì‹œì„± í…ŒìŠ¤íŠ¸', tag:'í…ŒìŠ¤íŠ¸', likes:0, ts:Date.now(), hidden:false}); writeCompliments(arr);
        }
        renderCompliments();
        openMarquee();
        assert(document.getElementById('overlay').classList.contains('show'),'ì „ê´‘íŒ ì—´ê¸° ì‹¤íŒ¨');
        closeMarquee();
        assert(!document.getElementById('overlay').classList.contains('show'),'ì „ê´‘íŒ ë‹«ê¸° ì‹¤íŒ¨');

        // Test 5: clearCompliments
        clearCompliments();
        assert(readCompliments().length===0,'clearCompliments ì‹¤íŒ¨');

        alert('âœ… ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼!');
      }catch(e){ console.error(e); alert('âŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: '+e.message); }
      finally{
        setPin(backupPin);
        writeCompliments(backup); renderCompliments();
      }
    };

    // ì´ˆê¸° ë Œë”ë§
    renderCompliments();
  </script>
</body>
</html>
